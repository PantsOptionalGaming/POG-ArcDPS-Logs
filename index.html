<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>POG FIGHT LOGS</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #1e1e1e;
        color: #fff;
        margin: 0;
        padding: 20px;
    }
    h1 {
        color: #FFD700; /* Yellow */
        text-align: center;
    }
    .filters {
        display: flex;
        gap: 20px;
        margin-bottom: 10px;
        justify-content: center;
    }
    select, button {
        padding: 5px 10px;
        font-size: 14px;
    }
    button {
        background-color: #FFA500; /* Orange */
        color: black;
        border: none;
        cursor: pointer;
        border-radius: 4px;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
    }
    th, td {
        padding: 10px;
        border: 1px solid #333;
        text-align: center;
    }
    th {
        background-color: #003366; /* Blue */
        cursor: pointer;
    }
    td {
        background-color: #2e2e2e;
    }
    .btn {
        padding: 5px 10px;
        background-color: #1E90FF; /* Blue button */
        color: black;
        border: none;
        cursor: pointer;
        text-decoration: none;
        display: inline-block;
        border-radius: 4px;
    }
    .btn:disabled {
        background-color: #555;
        cursor: not-allowed;
    }
    .table-container {
        max-height: 600px;
        overflow-y: auto;
    }
</style>
</head>
<body>

<h1>POG FIGHT LOGS</h1>

<div class="filters">
    <label>GameMode:
        <select id="filterGameMode">
            <option value="All">All</option>
            <option value="WVW">WvW</option>
            <option value="PvE">PvE</option>
        </select>
    </label>
    <label>Date:
        <select id="filterDate">
            <option value="All">All</option>
        </select>
    </label>
    <button id="downloadBtn">Download Logs</button>
</div>

<div class="table-container">
    <table id="logsTable">
        <thead>
            <tr>
                <th>Date</th>
                <th>Time</th>
                <th>GameMode</th>
                <th>ArcDPS Link</th>
                <th>Video Link</th>
            </tr>
        </thead>
        <tbody>
            <!-- Logs will populate here -->
        </tbody>
    </table>
</div>

<script>
const LOGS_URL = "https://raw.githubusercontent.com/PantsOptionalGaming/POG-ArcDPS-Logs/main/logs/logs.json";
const AUTO_REFRESH_INTERVAL = 60000; // 60 seconds
let logsData = [];
let filteredData = [];

// Fetch logs from GitHub
async function fetchLogs() {
    try {
        const response = await fetch(LOGS_URL + "?t=" + new Date().getTime()); // cache-busting
        logsData = await response.json();
        populateDateDropdown();
        showLatestDay();
    } catch (e) {
        console.error("Failed to fetch logs:", e);
    }
}

// Populate Date dropdown with available dates
function populateDateDropdown() {
    const dateSet = new Set(logsData.map(log => log.Date));
    const dateSelect = document.getElementById('filterDate');
    dateSelect.innerHTML = '<option value="All">All</option>';
    Array.from(dateSet).sort().forEach(date => {
        const option = document.createElement('option');
        option.value = date;
        option.textContent = date;
        dateSelect.appendChild(option);
    });
}

// Show latest WvW raid day by default
function showLatestDay() {
    const wvwLogs = logsData.filter(log => log.Result === "WVW");
    if(wvwLogs.length === 0) return;
    const latestDate = wvwLogs.reduce((a,b) => a.Date > b.Date ? a : b).Date;
    document.getElementById('filterDate').value = latestDate;
    filterAndRender();
}

// Filter logs based on dropdowns
function filterAndRender() {
    const gameMode = document.getElementById('filterGameMode').value;
    const date = document.getElementById('filterDate').value;

    filteredData = logsData.filter(log => {
        return (gameMode === "All" || log.Result === gameMode) &&
               (date === "All" || log.Date === date);
    });

    renderTable();
}

// Render table
function renderTable() {
    const tbody = document.querySelector('#logsTable tbody');
    tbody.innerHTML = "";

    // Sort by Date then Time descending
    filteredData.sort((a,b) => {
        if(a.Date === b.Date) return b.Time.localeCompare(a.Time);
        return b.Date.localeCompare(a.Date);
    });

    filteredData.forEach(log => {
        const tr = document.createElement('tr');

        const tdDate = document.createElement('td');
        tdDate.textContent = log.Date;
        tr.appendChild(tdDate);

        const tdTime = document.createElement('td');
        tdTime.textContent = log.Time;
        tr.appendChild(tdTime);

        const tdGameMode = document.createElement('td');
        tdGameMode.textContent = log.Result; // Rename Result to GameMode
        tr.appendChild(tdGameMode);

        const tdLink = document.createElement('td');
        const aLink = document.createElement('a');
        aLink.href = log.Link;
        aLink.target = "_blank";
        aLink.textContent = "View Log";
        aLink.className = "btn";
        tdLink.appendChild(aLink);
        tr.appendChild(tdLink);

        const tdVideo = document.createElement('td');
        const aVideo = document.createElement('a');
        aVideo.href = log.VideoLink || "#";
        aVideo.target = "_blank";
        aVideo.textContent = "View Video";
        aVideo.className = "btn";
        if(!log.VideoLink) aVideo.disabled = true;
        tdVideo.appendChild(aVideo);
        tr.appendChild(tdVideo);

        tbody.appendChild(tr);
    });
}

// Download filtered logs as JSON
function downloadLogs() {
    const blob = new Blob([JSON.stringify(filteredData, null, 2)], {type: "application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'POG_Logs.json';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
}

// Event listeners
document.getElementById('filterGameMode').addEventListener('change', filterAndRender);
document.getElementById('filterDate').addEventListener('change', filterAndRender);
document.getElementById('downloadBtn').addEventListener('click', downloadLogs);

// Initialize
fetchLogs();
setInterval(fetchLogs, AUTO_REFRESH_INTERVAL); // auto-refresh every 60s

</script>

</body>
</html>
